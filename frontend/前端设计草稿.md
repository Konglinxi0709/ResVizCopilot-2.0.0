
## 前端总体需求和架构设计

后端接口需要参考README.md和openapi.json
前端业务逻辑可以参考`test_CLI_frontend.py`中的程序。该程序为测试用的命令提示符前端，除了研究树的交互式编辑外，大部分的功能基本都实现了。

分为三大板块：
1. 工程存档管理，对应后端backend/routers/projects.py下的接口。
    - 对应老项目的`tests/frontend（老）/src/App/AppHeader.vue`组件
2. 研究树的可视化显示和交互式编辑，对应后端backend/routers/research_tree.py下的接口
    - 对应老项目的`tests/frontend（老）/src/App/MindTree.vue`和`tests/frontend（老）/src/App/ProblemInfo.vue`等相关组件
    - 主要技术基于开源项目mind-elixir。当前研究树主要包括实施问题、条件问题、解决方案三种节点，同时存在一系列约束，因此需要对思维导图进行魔改。总的来说，一方面要在前端实现研究树数据到思维导图数据的转化，其中不同类型的节点需要设定固定的节点风格来做区分，并且对选中方案等信息用节点风格做可视化；另一方面要全面重建用户交互，让用户对研究树的所有操作控制在约束下，所有操作由后端计算，前端只负责渲染（转为思维导图数据），因此每个操作后必须做数据同步。
3. 消息列表和AI对话功能，对应后端backend/routers/agents.py下的接口
    - 对应老项目`tests/frontend（老）/src/App/ChatBox.vue`、`tests/frontend（老）/src/components/ChatInput.vue`、`tests/frontend（老）/src/components/ChatMessage.vue`、`tests/frontend（老）/src/components/MarkdownRenderer.vue`等组件
    - 消息列表
        - 消息分为三种，用户消息、智能体消息、系统消息，每个角色需要配有相应的头像和名称（如智能体需要显示是负责哪个研究问题，如果属于方案的话负责哪个方案的专家），用户头像放在列表右侧，其它头像放在左侧，模仿QQ或者微信的群聊。
        - 每个消息本身要显示的内容包括标题、思考、内容三部分。以标题 >> 内容 >> 思考的层级可以展开，并且未展开的部分最好是不渲染的，减轻浏览器内存负担。老项目的消息只有内容 >> 思考的展开关系，没有标题层级，因而需要进行升级。消息的添加、回溯、更新等均通过patch实现，具体见测试前端。
        - 每个消息应该包含按钮交互功能
            1. 查看该消息对应的快照。此时更新研究树组件，临时的显示该消息对应的快照。需要在界面上提示出临时性
            2. 回溯到某个消息，即删除掉`该消息之后的所有消息`（不包括该消息），并且将当前研究树快照替换为该消息对应的快照。
            3. 复制消息文本内容
        - 消息的思考和内容均要使用`tests/frontend（老）/src/components/MarkdownRenderer.vue`组件进行markdown渲染。思考部分的字体颜色应该更淡一些
    - 输入框
        - 需要包含切换智能体的功能，同时对于需要选中节点的，也要根据具体的智能体调用要求，给出候选节点列表以供单选。
        - 需要存在一个终止生成按钮，停止当前智能体的生成

注意：任何研究树的操作、智能体的调用等必须均是互斥的，例如有智能体正在工作时，所有研究树操作和智能体调用输入框（除终止按钮以外）均要禁用。

前端的设计风格可以延续老项目的设计，充分利用element-plus库的组件，支持双语切换，技术上只能更先进，不能有退步。
单个文件的代码量不能过大，复杂且与显示无关的功能可以在.js文件中实现，复杂的组件可以拆分成多个组件。
组件之间尽量功能解耦，架构设计清晰规范。
有危险性的操作需要有统一的element-plus风格的消息确认框
整个前端的设计风格从宏观到微观要尽量统一